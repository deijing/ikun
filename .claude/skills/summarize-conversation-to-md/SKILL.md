---
name: summarize-conversation-to-md
description: Generate a highly compressed, continuation-friendly Markdown summary of the current conversation. Use this skill when the user needs to start a new conversation but wants to preserve essential context. The skill creates a concise summary file (default conversation-summary.md) that captures goals, key decisions, preferences, and next steps - enabling smooth continuation in a fresh session. If the summary file exists, append rather than overwrite.
---

# 对话摘要生成器

## 目的

生成高度压缩但可续接的对话 Markdown 摘要。这些摘要让新的对话会话能够无缝延续工作，仅保留最核心的语境：当前目标、关键洞察、重要决策、用户偏好、约束条件和计划的下一步行动。

## 何时使用此 Skill

在以下情况使用：
- 用户明确要求对话摘要
- 用户提到要开启新对话或新会话
- 用户想保存当前对话语境
- 用户要求创建用于续接的摘要
- 用户说「总结一下当前会话」「开新对话」等类似短语

## 核心原则

### 1. 价值驱动过滤

**仅**包含对续接有实际价值的信息：
- 当前目标或正在解决的问题
- 关键洞察、结论或技术决策
- 明确的用户偏好或工作习惯
- 重要的约束、限制或需求
- 具体的下一步行动

排除：
- 对话中的客套话和问候
- 详细的代码片段（改为总结目的）
- 已完成的逐步解释
- 冗余或重复的信息
- 可以轻易重新发现的信息

### 2. 自适应结构（无固定模板）

**不要**强制使用刻板的模板结构。摘要应该有机地反映对话中实际发生的内容：
- 如果有明确目标，就包含目标章节
- 如果有关键决策，就记录它们
- 如果没有约束条件，就完全省略那个章节
- 如果对话纯属探索性质，就相应地组织结构

摘要结构应该从对话内容中自然涌现。

### 3. 激进的信息聚合

通过抽象和综合**激进地压缩**：
- 把相关要点合并成简洁的陈述
- 使用项目符号和短段落
- 避免逐句复述对话轮次
- 提取模式而不是列举单项
- 在适当层次总结技术细节

目标阅读时间：**约 1 分钟**扫完整个摘要。

### 4. 默认追加模式

当目标文件存在时：
1. **先读取**现有文件
2. **追加**新摘要到末尾
3. 追加前插入清晰的分隔：
   ```markdown
   ---
   
   ## 会话摘要（YYYY-MM-DD HH:MM）
   ```
4. 使用当前日期和时间作为时间戳

## 摘要生成流程

### 步骤 1：分析对话

扫描整个对话以识别：
- 正在处理什么问题或目标？
- 达成了哪些关键结论或决策？
- 存在哪些约束或需求？
- 计划的下一步是什么？
- 什么模式揭示了用户偏好或习惯？

### 步骤 2：确定文件路径

**默认**：当前工作目录中的 `conversation-summary.md`。

如果用户指定了不同的路径或文件名，使用用户指定的。

### 步骤 3：检查现有文件

读取目标文件以确定模式：
- **文件存在**：追加模式（保留现有内容）
- **文件不存在**：创建模式（新文件）

### 步骤 4：组织摘要结构

**仅使用适用的章节**来组织信息：

**建议的章节**（仅在相关时使用）：
- 当前目标（如有明确目标）
- 问题背景（如对续接相关）
- 关键结论与决策（重要发现）
- 技术方案（如做出了技术决策）
- 约束与偏好（明确的限制或偏好）
- 下一步计划（计划的具体行动）
- 待解决问题（如有遗留阻塞）

**格式指南**：
- 列表使用项目符号
- 使用短段落（1-3 句）
- 谨慎使用粗体强调
- 技术术语使用代码格式：`functionName`、`file.py`
- 保持章节标题简洁

### 步骤 5：写入或追加

**如果创建新文件**：
直接写入摘要。

**如果追加到现有文件**：
1. 添加分隔线：`---`
2. 添加带时间戳的标题：`## 会话摘要（YYYY-MM-DD HH:MM）`
3. 添加新摘要内容

### 步骤 6：确认完成

告知用户：
- 写入的文件路径
- 是创建还是追加
- 简要描述捕获了什么（1 句话）

## 示例输出结构

```markdown
## 会话摘要（2025-01-14 15:30）

### 当前目标
- 为项目添加用户认证功能，支持 OAuth 和本地登录

### 关键决策
- 使用 JWT 而非 session，因为需要支持移动端
- 认证库选择 `passport.js`，团队已有使用经验
- 密码存储使用 bcrypt，salt rounds = 12

### 约束与偏好
- 用户倾向简洁方案，避免过度设计
- 需要保持向后兼容，不能破坏现有 API
- 部署环境：单体应用，非微服务

### 下一步计划
- 实现 JWT 中间件
- 添加用户注册和登录端点
- 编写认证相关测试
```

## 质量检查清单

完成摘要前，验证：
- [ ] 仅凭这份摘要，新对话能否有意义地延续？
- [ ] 每条信息是否对续接真正有价值？
- [ ] 能否在约 1 分钟内读完？
- [ ] 是否有不必要的章节可以删除？
- [ ] 语言是否清晰简洁？
- [ ] 如果是追加，是否有清晰的分隔和时间戳？

## 要避免的反模式

**不要这样做**：
- ❌ 逐字复制大段代码
- ❌ 写成对话的时序记录
- ❌ 包含讨论过的每个小细节
- ❌ 使用不适用的通用模板章节
- ❌ 覆盖现有摘要文件
- ❌ 写多段长篇解释
- ❌ 包含容易重新发现的信息

**而应该这样做**：
- ✅ 总结代码变更：「在 `auth.js:45` 实现了认证中间件」
- ✅ 提取本质：做出了什么决策以及为什么
- ✅ 聚焦于续接需要的，而非已完成的
- ✅ 仅使用适用的章节
- ✅ 追加时带清晰的时间戳
- ✅ 使用项目符号和短段落
- ✅ 捕获独特的洞察和决策
